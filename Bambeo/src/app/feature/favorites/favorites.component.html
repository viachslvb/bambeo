<!-- favorites.component.html -->
<ngx-spinner bdColor="rgba(255,255,255,0.0)" size="medium" color="#e11d48" type="ball-spin-rotate" [fullScreen]="true"
  [name]="favoritesLoadingSpinner">
</ngx-spinner>

<div class="container max-w-7xl mx-auto px-4 lg:px-6 my-10">
  <div *ngIf="isFavoritesLoaded" @fadeIn>
    <h1 class="text-3xl font-medium mb-2 text-slate-700">
      Moje Ulubione
    </h1>
    <h3 class="font-light text-slate-500 mb-6">
      Produkty z promocją: {{ promotionCount }}/{{ favoriteProducts.length }}
    </h3>
    <div *ngIf="favoriteProducts.length === 0" class="flex items-center w-fit my-8 space-x-4 lg:mt-4 p-4 text-slate-600 bg-white border border-slate-200 rounded-lg shadow">
      <i class="fa-solid fa-circle-info fa-2xl text-slate-500"></i>
      <div class="pl-3 text-sm font-normal">Aby śledzić zniżki na ulubione produkty, dodaj je do listy ulubionych.</div>
    </div>
    <div *ngIf="favoriteProducts.length > 0" class="flex flex-wrap -mx-2">
      <div *ngFor="let product of favoriteProducts" class="w-full xs:w-1/2 lg:w-1/3 mb-4">
        <a routerLink="/products/{{product.productId}}"
          class="flex flex-row xs:flex-col sm:flex-row md:max-w-xl items-center mx-2 h-full border border-slate-200 rounded-lg shadow group">
          <div class="flex w-2/6 xs:w-full md:w-2/6 flex-col xs:flex-row md:flex-col justify-center items-center">
            <img class="xs:h-36 md:h-28 w-36 object-contain md:rounded-none rounded-t-lg md:rounded-l-lg m-3"
              src="{{product.imageUrl}}" alt="">
          </div>
          <div class="flex w-4/6 xs:w-full md:w-4/6 flex-col justify-between h-full px-4 py-5 md:px-5 md:py-3 border-l border-slate-100 group-hover:bg-slate-50 transition-colors duration-200">
            <div class="text-slate-700 mb-3 md:mb-2">
              <h5 class="font-medium tracking-tight leading-tight py-0 my-0">{{ product.name }}</h5>
              <div class="text-sm">w <span class="underline text-rose-500">{{ product.store }}</span></div>
            </div>
            <!-- Promotion Details If Exists -->
            <ng-container *ngIf="product.hasPromotion">
              <div class="mb-4 md:mb-2">
                <div class="text-xs text-slate-700 mb-0.5">{{ product.promotion.discountCondition }}</div>
                <div class="flex items-center">
                  <div class="text-lg font-semibold text-white bg-rose-500 w-fit px-2 rounded">{{ product.promotion.price }}
                  </div>
                  <span class="text-xs px-1">zł / opak</span>
                  <div class="bg-yellow-300 text-white p-1 rounded font-semibold text-xs">-{{
                    product.promotion.discountPercentage }} %</div>
                </div>
              </div>
            </ng-container>
            <div class="flex items-center justify-between">
              <div class="flex items-center text-sm text-slate-700">
                <ng-container *ngIf="product.hasPromotion; else noPromotionTemplate">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 19.525"
                    style="enable-background:new 0 0 122.88 119.97" xml:space="preserve" class="w-4 h-4">
                    <path
                      d="M11.355.66c0-.365.36-.66.805-.66s.805.295.805.66v2.885c0 .365-.36.66-.805.66s-.805-.295-.805-.66V.66zM2.34 12.705h1.845c.115 0 .215.095.215.215v1.365a.215.215 0 0 1-.215.215H2.34a.215.215 0 0 1-.215-.215V12.92c0-.12.095-.215.215-.215zM9.405 8.82h1.845c.055 0 .105.025.145.06a6.575 6.575 0 0 0-1.85 1.735h-.14a.215.215 0 0 1-.215-.215V9.03c0-.12.095-.215.215-.215zm-3.535 0h1.845c.115 0 .215.095.215.215V10.4a.215.215 0 0 1-.215.215H5.87a.215.215 0 0 1-.215-.215V9.03c0-.115.095-.215.215-.215zm-3.535 0H4.18c.115 0 .215.095.215.215V10.4a.215.215 0 0 1-.215.215H2.34a.215.215 0 0 1-.215-.215V9.03c0-.115.095-.215.215-.215zm3.535 3.885h1.845c.115 0 .215.095.215.215v1.365a.215.215 0 0 1-.215.215H5.87a.215.215 0 0 1-.215-.215V12.92c0-.12.095-.215.215-.215zM16.845 9.69A5.11 5.11 0 0 1 20 14.415a5.12 5.12 0 0 1-5.11 5.11 5.105 5.105 0 0 1-3.615-1.495 5.105 5.105 0 0 1-1.495-3.615c0-2.055 1.28-3.975 3.18-4.755 1.18-.48 2.715-.45 3.885.035zm-2.74 4.585a.865.865 0 0 1 .225-.175v-2.225a.41.41 0 0 1 .41-.41.41.41 0 0 1 .41.41V14.1c.15.08.275.205.355.355h1.59a.41.41 0 1 1 0 .82h-1.59a.865.865 0 0 1-.765.46.875.875 0 0 1-.655-.295.87.87 0 0 1 .015-1.16zm3.82-2.815c-2.12-2.12-5.69-1.52-6.925 1.145a4.29 4.29 0 0 0-.395 1.805 4.29 4.29 0 0 0 1.255 3.035 4.275 4.275 0 0 0 3.035 1.255 4.285 4.285 0 0 0 3.035-1.255 4.275 4.275 0 0 0 1.255-3.035 4.285 4.285 0 0 0-.43-1.875 3.93 3.93 0 0 0-.825-1.075zM4.125.66c0-.365.36-.66.805-.66.445 0 .805.295.805.66v2.885c0 .365-.36.66-.805.66s-.805-.295-.805-.66V.66zM.885 6.315H16.22V2.99a.41.41 0 0 0-.405-.405h-1.47a.445.445 0 0 1 0-.89h1.47a1.3 1.3 0 0 1 .92.38 1.295 1.295 0 0 1 .38.92v5.28a6.77 6.77 0 0 0-.905-.245v-.825h.01H.885v8.61a.41.41 0 0 0 .405.405h7.285c.085.31.185.61.315.9H1.3a1.3 1.3 0 0 1-.92-.38 1.295 1.295 0 0 1-.38-.92V2.995a1.3 1.3 0 0 1 .38-.92 1.295 1.295 0 0 1 .92-.38h1.57a.445.445 0 0 1 0 .89H1.3a.41.41 0 0 0-.405.405v3.325h-.01zm6.135-3.73a.445.445 0 0 1 0-.89h2.995a.445.445 0 0 1 0 .89H7.02z" />
                  </svg>
                  <span class="text-xs ml-2">
                    Od {{ product.promotion.startDate | date:'d.MM' }} do {{
                    product.promotion.endDate | date:'d.MM' }}
                  </span>
                </ng-container>
                <ng-template #noPromotionTemplate>
                  <span class="font-light text-slate-500">
                    Brak promocji
                  </span>
                </ng-template>
              </div>
              <i (click)="confirmRemovingFromFavorites($event, product.productId)"
                class="fa-solid fa-heart text-rose-500 fa-2x hover:text-rose-600 transition-all duration-200 cursor-pointer"></i>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
  <!-- <div *ngIf="!isFavoritesLoaded && !isLoadingError" class="flex flex-col">
    <ngx-skeleton-loader
      [theme]="{ 'background-color': '#ffffff', 'border-radius': '0.5rem', width: '200px', height: '40px' }">
    </ngx-skeleton-loader>
    <ngx-skeleton-loader
      [theme]="{ 'background-color': '#ffffff', 'border-radius': '0.5rem', width: '170px', height: '30px' }">
    </ngx-skeleton-loader>
    <div class="flex flex-wrap -mx-2">
      <div class="w-full xs:w-1/2 lg:w-1/3 px-2" *ngFor="let i of [1, 2, 3, 4];">
        <ngx-skeleton-loader
          [theme]="{ 'background-color': '#ffffff', 'border-radius': '0.5rem', width: '100%', height: '130px' }">
        </ngx-skeleton-loader>
      </div>
    </div>
  </div> -->
</div>
<div *ngIf="isLoadingError" class="mt-20">
  <bb-loading-error></bb-loading-error>
</div>
<p-confirmDialog></p-confirmDialog>